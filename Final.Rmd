---
title: "UFO"
author: "Shealagh Brown & Sam Zimpfer"
date: "2025-03-20"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load(gapminder, socviz, tidyverse, grid, ggthemes,
               usmap, maps, statebins, viridis, leaflet, lubridate, broom) 
theme_bw()
```

## Introduction

## Cleaning the data

The code chunk below reads in our data about UFO sightings. We had to convert the datetime variable to year, month, date format. Then we created a new data frame containing only necessary variables for our purposes. Latitude had to then be convered into a numeric variable.

The variables used are:
**datetime**: the date and time of sighting in year, month, day, hours, minutes, seconds format. \
**city**: city where sighitng occurred \
**state**: state where sighting occurred \
**country**: country where sighting occurred \
**seconds**: duration of sightings in seconds \
**latitude**: latitude of sighting \
**longitude**: longitude of sighing \
**year**: year when sighing occurred \
**month**: month when sighting occured \

```{r cars}
ufo_raw <- read.csv("ufo_sightings_scrubbed.csv")

#convert date time to ymd_hms format
ufo_raw$datetime <- ymd_hms(ufo_raw$datetime)

#cleaning data
ufo<- ufo_raw|>
   mutate(seconds = duration..seconds.,
          year = year(datetime), #create year column
          month = month.name[month(datetime)])|> #create month column and convert to name 
  select(datetime, city, state, country, seconds,latitude,longitude, year, month)
  
ufo$latitude <- as.numeric(ufo$latitude) #changing lat to numeric


```

## Data Summary 

The first question we wanted to answer is where do most UFO sightings occur. 

We created graphs of sighingts based on longitude and latitudue 
```{r pressure, longitude & latitude }
long_hist <- ggplot(
  data = ufo,
  mapping = aes( x= longitude
  )
)+
  geom_histogram(fill = "olivedrab", 
                 color = "black", 
                 bins = 40)+
  labs(
    title = "Number of sightings per longitude",
    x = "Longitude",
    y = "Number of Sightings"
  )+
  scale_x_continuous(breaks = seq(-200, 200, 20))+
  scale_y_continuous(expand = c(0, 0, 0.05, 0))

lat_hist <- ggplot(
  data = ufo,
  mapping = aes( x= latitude
  )
)+
  geom_histogram(fill = "olivedrab", 
                 color = "black",
                 bins = 40)+
  labs(
    title = "Number of sightings per lattitude",
    x = "Latitude",
    y = "Number of Sightings"
  )+
  scale_x_continuous(breaks = seq(-100, 100, 20))+
  scale_y_continuous(expand = c(0, 0, 0.05, 0))

long_hist
lat_hist
```

### Observations
* Longitudes of sightings appear to be concentrated around -120 through -70 (Number of sightings per longitude)
* Lattitude of sightings appear to be concentrated around 30 through 50 (Number of sightings per lattitude)

---


## Scatter plot of sighting locations 
```{r , map }
map <- map_data("world")

map_plot <- ggplot()+
  geom_polygon(data = map,
               mapping = aes(x= long,
                             y = lat,
                             group = group),
               fill = "darkgreen")+
  geom_point(data = ufo,
             mapping = aes(x = longitude,
                           y = latitude),
             size = 0.3)+
  labs(
    x = "Longitude",
    y = "Latitude"
  )+
scale_y_continuous(expand = c(0, 0, 0.05, 0))+
  ylim(-60,90)

map_plot
```

### Observations
* Most of the sightings are concentrated in North America and in Europe

---


## Bar graph of sightings per country
```{r, bar graph of countries and cities}

modified_data = ufo |> filter(country != "")

ggplot(data = modified_data,
       mapping = aes(x = country))+
  geom_bar(fill = "blue4",
           color = "black",
           na.rm = T)+
scale_y_log10(expand = c(0, 0, 0.05, 0))+
  labs(title = "Total number of sightings per country",
       x = "Country",
       y = "Count (log10 scale)")
  
         
```

### Observations
* This graph supports the fact that the US, Canada, and Great Britain contain most of the sightings

---


## Bar graph of sightings per year
```{r, bar graph of sightings per year}
ggplot( data = ufo,
        mapping = aes(x = year))+
  geom_histogram(fill = "hotpink",
                 color = "black",
                 bins = 20)+
  labs(
    x = "Year",
    y = "Number of Sightings"
  )+
scale_y_continuous(expand = c(0, 0, 0.05, 0))

by_month <- ggplot( data = ufo,
        mapping = aes(x = month))+
  geom_bar(fill = "purple",
                 color = "black")+
  labs(
    x = "Month",
    y = "Number of Sightings"
  )+
scale_y_continuous(expand = c(0, 0, 0.05, 0))+
theme(
  axis.text = element_text( angle = 90
     )
)
```

### Observations
* Sightings increased dramatically around late 1990s and early 2000s, then seemed to remain relatively constant after 2010

---


## Small Multiples Graph of Number of Sightings Per Month Since Year 2000
```{r, small multiples}
# create table of year, month, number of sightings
summary <- ufo |> filter(year >= 2000) |> group_by(year, month) |> summarise(count = n())

# order data by natural month ordering
summary$month <- factor(summary$month, levels = month.name)
summary <- summary |> arrange(year, month)

ggplot(data = summary,
       mapping = aes(x = month,
                     y = count,
                     group = 1)) +
  geom_line() +
  labs(x = "Month",
       y = "Number of Sightings") +
  scale_y_continuous(expand = c(0, 0, 0.05, 0)) +
  theme(axis.text.x = element_text(angle = 90)) +
  facet_wrap(~ year)
```

### Observations
* The average number of sightings per year seems to increase over time
* Sightings appear to be most prevalent during late summer and early fall, possibly because more people are outside around this time of year

---


## Linear Regression Model for Duration of Sightings vs Longitude and Lattitude
```{r, regression model}
ufo_trimmed <- ufo |> filter(year > 2005)
ufo_trimmed$seconds <- as.numeric(ufo_trimmed$seconds)
model_lat = lm(formula = seconds ~ latitude,
               data = ufo_trimmed)
model_long = lm(formula = seconds ~ longitude,
                data = ufo_trimmed)
model_both <- lm(formula = seconds ~ latitude + longitude,
                 data = ufo_trimmed)

show_resid_plot <- function(model, name) {
  augment_columns(x = model, 
                  data = ufo_trimmed) |> 
    ggplot(mapping = aes(x = .fitted,
                         y = .resid)) + 
    geom_point() + 
    geom_hline(yintercept = 0,
               color = "darkred",
               linetype = "dashed",
               linewidth = 1) + 
    geom_smooth(method = "loess",
                se = F) + 
    labs(title = paste(name, "Residuals"),
         y = ".resid (seconds)")
}

show_resid_plots_split <- function(model, name) {
  # classify data as short duration or long duration
  augmented <- augment_columns(x = model, 
                               data = ufo_trimmed) |>
    mutate(long = abs(.resid) > 0.25 * sd(.resid, na.rm = TRUE))
  
  augmented |>
    filter(!long) |>
    ggplot(aes(x = .fitted, 
               y = .resid)) +
    geom_point(alpha = 0.6) +
    geom_hline(yintercept = 0, 
               linetype = "dashed", 
               color = "darkred") +
    geom_smooth(method = "loess", 
                se = FALSE) +
    labs(title = paste(name, "Residuals (Short duration)"),
         y = ".resid (seconds)")
  
  augmented |>
    filter(long) |>
    ggplot(aes(x = .fitted, 
               y = .resid)) +
    geom_point() +
    geom_hline(yintercept = 0, 
               linetype = "dashed", 
               color = "darkred") +
    labs(title = paste(name, "Residuals (Long duration)"),
         y = ".resid (seconds log10)") + 
    scale_y_log10() 
}

show_resid_plots_split(model_lat, "Latitude Model")
#show_resid_plots(model_long, "Longitude Model")
#show_resid_plots(model_both, "Latitude + Longitude Model")

```

### Observations
* The model behaves slightly strangely, likely because sightings that are concentrated around certain longitudes and latitudes are being interpreted linearly
* There are much more positive residuals than negative residuals, however the line of best fit through the points is close to or less than 0. This indicates that most of the sightings were very short, and a much smaller portion was significantly longer

---


## Using the Model
